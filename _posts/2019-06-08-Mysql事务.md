---
title: Mysql——事务
tags: java  
         Mysql
renderNumberedHeading: true
grammar_cjkRuby: true
---



# **Mysql——事务**
1. 事务的四个特性：ACID
（1）A：原子性，即事务是不可分割的工作单位，要么都执行，要么都不执行，如银行的转账；
（2）C：一致性，即事务开始之前和结束之后，数据库的完整性约束没有被破坏，从一种一致性状态变为另一种一致性状态；
（3）I：隔离性，即事务之间相互是不可见的；
（4）D：持久性：即事务提交之后结果就是永久性的。
2. 实现ACID的操作：
   （1）隔离性：通过加锁实现；
   （2）原子性和持久性：通过redo log实现；
   （3）一致性：通过undo log实现；
3.  redo log & undo log & binlog：
    redo log:重做日志，记录的是页的物理修改操作，是物理日志；
	undo log：是逻辑日志，根据每行记录进行记录；
	binlog：和redo log相似，都是记录了对于数据库操作的日志，但是二者有很大不同：（1）redo log在InnoDB存储引擎层产生，而binlog在Mysql数据库上层产生；（2）redo log是物理日志，记录的是对每个页的修改，binlog是逻辑日志，记录的是对应的Sql语句；（3）二者写入磁盘时间点不同，redo log在事务进行中不断被写入，binlog只在事务提交完成后进行一次写入。
  4. 事务的隔离级别：
   了解事务的隔离级别之前先了解几种现象：
   （1）脏读：即一个事务读取了另一个事务还未提交时的数据，而这个数据有可能回滚，则这个事务就读到了不正确的数据；
   （2）不可重复读：即一个事务多次读取同一数据却返回了不同的结果，这是因为在读取过程中其他事务进行了修改；
   （3）丢失更新：即一个事务的更新操作被另一个事务的更新操作覆盖，从而导致数据的不一致.
   （4）幻像问题（Phantom Problem）：指在同一事务下，连续执行两次同样的SQL语句可能导致不同的结果，第二次的SQL语句可能会返回之前不存在的行.
   对应的隔离级别分别为：
   （1）READ UNCOMMITTED：读未提交；即一个事务还未提交时就可被其他事务看到，可产生幻读、不可重复读、脏读问题；
   （2）READ COMMITTED：读已提交；即一个事务提交之后才能被其他事务看到，会出现不可重复读、幻读；
   （3）REPEATABLE READ：可重复读；即一个事务在执行过程中看到的数据和它在启动时看到的数据是一致的，会出现幻像问题，不会出现不可重复读.
   （4）SERIALIZABLE：串行化
   其中不同的隔离级别对应不同的加锁。
5. 各种锁：
     根据不同的方式划分不同锁：
5.1 根据锁的兼容性：			 
 - 共享锁（读锁）：S锁，允许事务读一行数据；
 - 排他锁（写锁）：X锁，允许事务删除或更新一行数据
5.2 根据加锁范围：
 -    表级锁：MyISAM引擎是表锁设计
 -    行级锁：InnoDB引擎支持行级锁，并具有3种行锁的算法：
	   （a）Record lock：单个行记录上的锁；
	   （b）Gap Lock：间隙锁，锁定一个范围，但不包含记录本身；
	   （c）Next-key Lock：锁定一个范围，并且锁定了记录本身；通过这种方式解决了幻读现象
5.3 根据锁的使用：
 -   悲观锁：总是假设最坏的情况，认为别人拿数据就会更改，因此每次在拿数据的时候就加上锁；
 - 	乐观锁：总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号机制和CAS算法实现。

			 