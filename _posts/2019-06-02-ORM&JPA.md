---
title: ORM-JPA
tags: SpringBoot
renderNumberedHeading: true
grammar_cjkRuby: true
---


# ORM
1. ORM(Object Relational Mapping-ORM),即对象关系映射，是通过使用描述对象和数据库之间映射的元数据，将面向对象语言程序中的对象自动持久化到关系数据库中，简单来说就是将数据库表与java实体对象做一个映射，一般是在entity层和dao层实现；
   其中ORM的主流框架一般有Hibernate、mybatis（半自动）；
2. JPA(Java Persistence API)即java持久化规范，为开发人员提供了一种对象、关联映射工具来管理Java应用中的关系数据，可以简化持久化开发工作和整合ORM技术，结束了各种ORM框架各自为营的局面，就是说JPA是一套规范，各种ORM框架是产品，如果某个产品实现了这个JPA规范，就可以成为JPA的实现产品；JPA主要包括三方面的内容：
   （1）一套API标准：用来操作实体对象，执行CRUD操作，框架在后台完成所有事情，可以使得开发者从繁琐的JDBC和SQL代码中解脱出来；
   （2）面向对象的查询语言：通过面向对象而非面向数据库的查询语言查询数据，避免程序的SQL语句紧密耦合；
   （3）ORM元数据的映射：元数据描述对象和表之间的映射关系，框架据此将实体对象持久化到数据库表中；
3. Spring Data JPA就是Spring基于ORM框架、JPA规范的基础上封装的一套JPA应用框架。
4. 在具体的代码实现上，其编码过程为：
   （1）在pom.xml文件添加相关依赖；
   （2）在yml文件添加mysql和jpa的相关设置；
   （3）entity层：添加数据库表实体，注意一些注解的使用；
   （4）dao层：即为数据库表实体添加仓库接口，不需要再写CURD操作，如果有个性化的操作再实现即可；
 5. entity层及dao层常用到的注解：
    （1）@Data：注在类上，这是lombok工具类库中的一个注解，之前在添加依赖时添加了lombok，这个工具类库的作用就是简化代码，而使用@Data注解，就可以自动生成get\set等相关方法；
	（2）@NoArgsConstructor：注在类上，提供类的无参构造；
	（3）@AllArgsConstructor：注在类上，提供类的全参构造；
	（4）@entity： 注在类上，表明该类是一个实体类，默认对应数据库中的表明是user_entity，可以添加属性@Entity(name="...")修改表名，也可以与@Table一起使用
	（5）@Column：注在属性上，即将成员属性映射到关系表中哪一列和该列的结构信息，比如映射的列名name="..."，是否唯一unique=true，是否为空nullable=false；
	（6）@Id：注在属性上，指定表的主键，与主键一起使用的还有@GeneratedValue与@GenericGenerator，其中这两个注解的区别就在于前者是JPA通用的生成器，后者是自定义的主键生成器，查看源码可以看到JPA提供了四种生成类型：TABLE：即使用一个特定的数据库表格保存主键，@SEQUENCE：使用底层数据库的序列来生成主键；IDENTITY：主键由数据库自动生成；AUTO：主键由程序控制，默认使用AUTO
	（7）@Basic：是实体类与数据库字段映射最简单的类型，如果在实体类属性上不加@Basic也会自动加上@Basic，注解中fetch()用来指定属性的加载机制，默认为EAGER（即时加载），LAZY（懒加载），即时加载就是在实例化对象的时候必须加载该属性值，懒加载就是只有在调用该属性时才加载。
	（8）@Repository：该注解用来标识Spring bean，即将数据访问层（dao层）的类标识为Spring bean，另外它可以在持久层作为一个标记去自动处理数据库操作产生的异常，因为原生的java操作数据库所产生的异常只定义了几种，但是产生数据库异常的原因却有很多种，这样对数据库操作的报错排查造成了一定的影响，而Spring拓展了原生的持久层异常，针对不同的产生原因有了更多的异常进行描述，所以在添加该注解的类上，如果数据库操作中抛出异常就能对其进行处理，转而抛出翻译后的spring专属数据库异常，方便对异常进行排查处理。